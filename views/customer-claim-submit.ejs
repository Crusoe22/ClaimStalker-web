<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Customer Claim Submission | Claim Stalker</title>
<link rel="stylesheet" href="/customer-claim-submit.css">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png"> 
</head>
<body>

<!-- Header -->
<header class="navbar">
    <div class="logo">Claim Stalker</div>
    <p class="subtitle">Submit Your Insurance Claim</p>
</header>

<!-- Claim Submission Form -->
<main class="content">
    <form id="customerClaimForm" class="claim-form" novalidate enctype="multipart/form-data">
        <h1>Submit Your Claim</h1>
        <p class="form-intro">Please complete the form below to start your insurance claim process.</p>

        <div class="form-grid">
            <!-- Required Fields -->
            <div class="form-group">
                <label for="policyNumber">Policy Number</label>
                <input type="text" id="policyNumber" name="policyNumber" placeholder="Policy Number" required>
            </div>

            <div class="form-group">
                <label for="firstname">First Name</label>
                <input type="text" id="firstname" name="firstname" placeholder="John" required>
            </div>

            <div class="form-group">
                <label for="lastname">Last Name</label>
                <input type="text" id="lastname" name="lastname" placeholder="Doe" required>
            </div>

            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" name="email" placeholder="example@email.com" required>
            </div>

            <div class="form-group">
                <label for="phone">Phone Number</label>
                <input type="tel" id="phone" name="phone" placeholder="(123) 456-7890" required>
            </div>

            <div class="form-group">
                <label for="claimDate">Date of Loss</label>
                <input type="date" id="claimDate" name="claimDate" required>
            </div>

            <!-- Optional Address Fields -->
            <div class="form-group full-width">
                <label for="address_1">Address Line 1</label>
                <input type="text" id="address_1" name="address_1" placeholder="123 Main St" required>
            </div>

            <div class="form-group full-width">
                <label for="address_2">Address Line 2</label>
                <input type="text" id="address_2" name="address_2" placeholder="Apt, Suite, etc.">
            </div>

            <div class="form-group">
                <label for="state">State</label>
                <input type="text" id="state" name="state" placeholder="State">
            </div>

            <div class="form-group">
                <label for="zip_code">Zip Code</label>
                <input type="text" id="zip_code" name="zip_code" placeholder="12345">
            </div>

            <div class="form-group full-width">
                <label for="description">Description of Loss</label>
                <textarea id="description" name="description" rows="4" placeholder="Describe what happened..." required></textarea>
            </div>

            <div class="form-group full-width">
                <label for="photos">Upload Photos (optional, multiple allowed)</label>
                <input type="file" id="photos" name="photos" multiple accept="image/*">
            </div>
        </div>

        <div class="form-buttons">
            <input type="reset" value="Reset">
            <input type="submit" value="Submit Claim">
        </div>
    </form>
</main>

<!-- Popup Modal -->
<div id="popupModal" class="modal">
    <div class="modal-content">
        <h2 id="popupMessage"></h2>
        <button class="close-btn" onclick="closeModal()">Close</button>
    </div>
</div>

<!-- JavaScript -->
<script>
const claimForm = document.getElementById("customerClaimForm");
const modal = document.getElementById("popupModal");
const popupMessage = document.getElementById("popupMessage");

// ---- Custom Validation Messages ----
const customMessages = {
    policyNumber: "Please enter your policy number.",
    firstname: "Please enter your first name.",
    lastname: "Please enter your last name.",
    email: "Please enter a valid email address.",
    phone: "Please enter your phone number.",
    claimDate: "Please select the date of loss.",
    address_1: "Please enter your address.",
    description: "Please describe what happened."
};

for (const [id, message] of Object.entries(customMessages)) {
    const input = document.getElementById(id);
    if (input) {
        input.addEventListener("invalid", function () { this.setCustomValidity(message); });
        input.addEventListener("input", function () { this.setCustomValidity(""); });
    }
}

claimForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    if (!claimForm.checkValidity()) {
        claimForm.reportValidity();
        return;
    }

    const formData = new FormData(claimForm); // IMPORTANT: keep actual files

    try {
        const response = await fetch("/submit-customer-claim", {
            method: "POST",
            body: formData // ⬅️ no headers, no JSON. Sends files correctly.
        });

        const result = await response.json();
        popupMessage.textContent = result.message;
        modal.style.display = "flex";

    } catch (error) {
        popupMessage.textContent = "An error occurred. Please try again.";
        modal.style.display = "flex";
    }
});

function closeModal() {
    modal.style.display = "none";
    claimForm.reset();
}

window.onclick = function(event) {
    if (event.target === modal) closeModal();
};

/*
// ---- Handle Form Submission ----
claimForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    if (!claimForm.checkValidity()) {
        claimForm.reportValidity();
        return;
    }

    const formData = new FormData(claimForm);

    // Convert file inputs into array of URLs or file names
    const photoFiles = formData.getAll("photos");
    const photoUrls = photoFiles.length ? Array.from(photoFiles).map(f => f.name) : [];

    // Build payload
    const data = {
        policyNumber: formData.get("policyNumber"),
        firstname: formData.get("firstname"),
        lastname: formData.get("lastname"),
        email: formData.get("email"),
        phone: formData.get("phone"),
        claimDate: formData.get("claimDate"),
        address_1: formData.get("address_1"),
        address_2: formData.get("address_2") || null,
        state: formData.get("state") || null,
        zip_code: formData.get("zip_code") || null,
        description: formData.get("description"),
        photo_urls: photoUrls
    };

    try {
        const response = await fetch("/submit-customer-claim", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        });

        const result = await response.json();
        popupMessage.textContent = result.message || "Your claim has been submitted successfully!";
        modal.style.display = "flex";
    } catch (error) {
        console.error(error);
        popupMessage.textContent = "An error occurred. Please try again later.";
        modal.style.display = "flex";
    }
});

function closeModal() {
    modal.style.display = "none";
    claimForm.reset();
}

window.onclick = function(event) {
    if (event.target === modal) closeModal();
};*/
</script>

</body>
</html>
